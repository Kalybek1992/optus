{% extends './Navbar/Navbar.twig' %}

{% block content %}

    {% include './Breadcrumb/Categories.twig' %}

    <div class="flex justify-center mt-10">
        <div class="w-[700px] space-y-4">
            <!-- Категории расходов -->
            <div id="categoryApp" x-data="{ open: true, level: 0, path: [] }" class="relative w-full">

                <!-- Отображение выбранной категории -->
                <div class="w-full text-left bg-white border border-gray-300 px-5 py-3 rounded-xl shadow-sm text-base font-medium">
                    <template x-if="path.length === 0">
                        <span class="text-gray-400">Категорий расхода</span>
                    </template>
                    <template x-if="path.length > 0">
                        <span id="category" x-text="path.join(' > ')"></span>
                    </template>
                </div>

                <!-- Выпадающее меню -->
                <div class="mt-2 w-full z-50 bg-white border border-gray-200 rounded-xl shadow-xl p-4 space-y-3 transition-all duration-300">

                    <!-- Назад -->
                    <div x-show="level > 0" class="mb-2">
                        <button @click="level--; path.pop()" class="text-sm text-blue-600 hover:underline">← Назад
                        </button>
                    </div>

                    <!-- Категории -->
                    {% if categories_html is empty %}
                        <div class="flex justify-center">
                            <button
                                    class="py-2 px-4 border border-blue-500 rounded-md text-blue-600 hover:bg-blue-100 transition"
                                    onclick="addCategoriesAtLevel({0:0})">
                                Добавить категорию
                            </button>
                        </div>

                    {% else %}
                        {{ categories_html|raw }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>


    <!-- Модальное окно добавления категории -->
    <input type="checkbox" id="add_categories" class="modal-toggle"/>
    <div class="modal" role="dialog">
        <div class="modal-box rounded-lg p-6"> <!-- убрали рамку у модалки -->
            <h1 id="changePasswordTitle" class="text-lg font-bold mb-4">Новая категория</h1>
            <div id="category_parent" class="text-blue-500 font-bold pl-[10px] py-2"></div>
            <label class="flex items-center gap-2 p-2">
                <input type="text" id="new_categories" name="categories"
                       placeholder="Укажите название категории"
                       required
                       class="w-full outline-none rounded-lg border border-blue-500 px-4 py-2 focus:ring-1 focus:ring-blue-500 transition-all duration-200"/>
            </label>
            <div class="modal-action mt-4 flex gap-2">
                <button id="confirm_category"
                        class="btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                    Сохранить
                </button>
                <label for="add_categories"
                       class="btn border border-gray-300 hover:bg-gray-100 px-6 py-2 rounded-lg">
                    Закрыть
                </label>
            </div>
        </div>
    </div>

    <!-- Модальное окно удаления категории -->
    <input type="checkbox" id="delete_category" class="modal-toggle"/>
    <div class="modal" role="dialog">
        <div class="modal-box rounded-lg p-6 border-0"> <!-- убрали рамку -->
            <h1 class="text-lg font-bold mb-2">Вы действительно хотите удалить категорию?</h1>
            <!-- Элемент с данными -->
            <div class="p-2 border border-blue-500 rounded-[6px]">
                <span id="modal_category" class="font-bold text-blue-500"></span>
            </div>


            <!-- Информационное сообщение -->
            <div class="alert alert-info rounded-xl mt-3 text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                </svg>
                <span class="text-white">Если к этой категории привязаны расходы, после её удаления будет невозможно найти эти расходы по данной категории.</span>
            </div>
            <div class="modal-action flex gap-2 mt-4">
                <button id="confirm_delete_category"
                        class="btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                    Подтвердить
                </button>
                <label for="delete_category"
                       class="btn border border-gray-300 hover:bg-gray-100 px-6 py-2 rounded-lg">
                    Отменить
                </label>
            </div>
        </div>
    </div>

    <!-- Модальное окно ошибки -->
    <dialog id="errorModal" class="modal">
        <div class="modal-box rounded-lg">
            <h3 class="text-lg font-bold">Ошибка!</h3>
            <p id="errorText" class="py-4">Неправильный формат Почты</p>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                        Закрыть
                    </button>
                </form>
            </div>
        </div>
    </dialog>

    <script>
        const addCategoryCheckbox = document.getElementById('add_categories');
        const newCategoryInput = document.getElementById('new_categories');
        const categoryParent = document.getElementById('category_parent');

        // Сброс инпута и category_parent при закрытии модального окна
        addCategoryCheckbox.addEventListener('change', () => {
            if (!addCategoryCheckbox.checked) {
                newCategoryInput.value = '';
                categoryParent.innerHTML = '';
            }
        });

        // Сброс при перезагрузке страницы
        window.addEventListener('load', () => {
            newCategoryInput.value = '';
            categoryParent.innerHTML = '';
            addCategoryCheckbox.checked = false;
        });
    </script>

    <script src="/assets/js/PostData.js?v=<?= time() ?>"></script>
    <script src="/assets/js/Categories.js?v=<?= time() ?>"></script>


{% endblock %}
