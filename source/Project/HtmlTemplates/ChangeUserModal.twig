{% block content %}

    <!-- input type="Email" -->
    <input type="checkbox" id="change_email" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box w-11/12 max-w-md md:max-w-md p-6">
            <h1 class="text-lg font-bold text-gray-800 mb-4">–ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã</h1>

            <div class="space-y-4">
                <!-- Email input -->
                <div class="flex flex-col w-full">
                    <span class="font-semibold text-gray-700 mb-2">–ù–æ–≤–∞—è –ø–æ—á—Ç–∞:</span>
                    <label class="input w-full flex items-center gap-2 border rounded-md p-2 bg-white">
                        <svg class="h-5 w-5 text-gray-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                        </svg>
                        <input type="email" id="new_email" name="email" placeholder="mail@site.com" required
                               class="w-full outline-none text-gray-800" />
                    </label>
                    <div class="validator-hint text-sm text-gray-500 mt-1 hidden" id="emailHint">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç -->
                <div class="alert alert-info rounded-xl text-white flex items-start gap-2 p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white mt-1" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                    </svg>
                    <span class="text-white text-sm md:text-base">
                    –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –≤—Ö–æ–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç –ø–æ —Å—Ç–∞—Ä–æ–º—É –∞–¥—Ä–µ—Å—É –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ –Ω–æ–≤—É—é –ø–æ—á—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.
                </span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="modal-action mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4 justify-end">
                <label id="submitChangeEmail" class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ò–∑–º–µ–Ω–∏—Ç—å
                </label>
                <label id="changeEmailClose" for="change_email" class="btn btn-outline rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ó–∞–∫—Ä—ã—Ç—å
                </label>
            </div>
        </div>
    </div>


    <!-- input type="password" -->
    <input type="checkbox" id="change_password" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box w-11/12 max-w-md p-6">
            <h1 class="text-lg font-bold text-gray-800 mb-4">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h1>

            <div class="space-y-4">
                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è -->
                <div class="flex flex-col w-full">
                    <span class="font-semibold text-gray-700 mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</span>
                    <label class="input w-full flex items-center gap-2 border rounded-md p-2 bg-white">
                        <svg class="h-5 w-5 text-gray-400 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 15v2m0-6a2 2 0 00-2 2v4a2 2 0 004 0v-4a2 2 0 00-2-2zm6-4V7a6 6 0 00-12 0v2" />
                            <rect x="6" y="10" width="12" height="10" rx="2" ry="2"></rect>
                        </svg>
                        <input type="text" id="new_password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                               required class="w-full outline-none text-gray-800" />
                    </label>
                    <div class="validator-hint text-sm text-gray-500 mt-1" id="passwordHint">
                        –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="alert alert-info rounded-xl text-white flex items-start gap-2 p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white mt-1" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                    </svg>
                    <span class="text-white text-sm md:text-base">
                    –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–æ–±—â–∏—Ç—å –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏–Ω–∞—á–µ –≤—Ö–æ–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.
                </span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="modal-action mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4 justify-end">
                <label id="generatePassword" class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                </label>
                <label id="submitChangePassword" class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ò–∑–º–µ–Ω–∏—Ç—å
                </label>
                <label id="changePasswordClose" for="change_password" class="btn btn-outline rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ó–∞–∫—Ä—ã—Ç—å
                </label>
            </div>
        </div>
    </div>


    <!-- type="unlink_account" -->
    <input type="checkbox" id="unlink_account" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box w-11/12 max-w-md p-6">
            <h1 class="text-lg font-bold text-gray-800 mb-4">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–≤—è–∑–∞—Ç—å —Å—á—ë—Ç?</h1>

            <div class="space-y-4">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                    <span id="unlinkUserName" class="text-gray-800 mt-1 break-all"></span>
                </div>

                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ò–ù–ù:</span>
                    <span id="companyInn" class="text-gray-800 mt-1 break-all"></span>
                </div>

                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</span>
                    <span id="companyName" class="text-gray-800 mt-1 break-all"></span>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="alert alert-info rounded-xl mt-3 text-white flex items-start gap-2 p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white mt-1" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                    </svg>
                    <span class="text-white text-sm md:text-base">
                    –ü–æ—Å–ª–µ –æ—Ç–≤—è–∑–∫–∏ —Å—á—ë—Ç–∞ –≤—Å–µ –¥–æ–ª–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.
                </span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="modal-action mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4 justify-end">
                <button id="confirmUnlink" class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
                <label for="unlink_account" class="btn btn-outline rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </label>
            </div>
        </div>
    </div>

    <!-- unlink_transaction -->
    <input type="checkbox" id="unlink_transaction" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box w-11/12 max-w-md p-6">

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <h1 class="text-lg font-bold text-gray-800 mb-4">
                –û—Ç–≤—è–∑–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            </h1>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="space-y-4">

                <!-- –ü–ª–∞—Ç–µ–ª—å—â–∏–∫ -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ü–ª–∞—Ç–µ–ª—å—â–∏–∫:</span>
                    <span id="unlinkPayer" class="text-gray-800 mt-1 break-all"></span>
                </div>

                <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</span>
                    <span id="unlinkReceiver" class="text-gray-800 mt-1 break-all"></span>
                </div>

                <!-- –°—É–º–º–∞ -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–°—É–º–º–∞:</span>
                    <span id="unlinkAmount" class="text-gray-800 mt-1"></span>
                </div>

                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
                <div class="alert alert-warning rounded-xl mt-3 flex items-start gap-2 p-3">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-6 w-6 shrink-0 stroke-current mt-1"
                         fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 9v2m0 4h.01M5.07 19h13.86c1.54 0 2.5-1.67 1.73-3L13.73 4c-.77-1.33-2.69-1.33-3.46 0L3.34 16c-.77 1.33.19 3 1.73 3z"/>
                    </svg>
                    <span class="text-sm md:text-base">
                    –ü–æ—Å–ª–µ –æ—Ç–≤—è–∑–∫–∏ –¥–æ–ª–≥ —É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω.<br>
                    –í—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞–Ω–æ–≤–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
                </span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="modal-action mt-6 flex flex-col sm:flex-row gap-3 justify-end">
                <button id="confirmUnlinkTransaction"
                        class="btn bg-red-600 hover:bg-red-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto">
                    –û—Ç–≤—è–∑–∞—Ç—å
                </button>

                <label for="unlink_transaction"
                       class="btn btn-outline rounded-lg px-6 py-2 w-full sm:w-auto">
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </label>
            </div>
        </div>
    </div>


    <!-- type="delete_account" -->
    <input type="checkbox" id="delete_account" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box max-w-md">
            <h1 class="text-lg font-bold text-gray-800 mb-4">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?</h1>

            <div class="space-y-3">
                <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ò–º—è:</span>
                    <span id="deleteName" class="text-gray-800 mt-1 break-all">‚Äî</span>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="alert alert-info rounded-xl mt-3 text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                    </svg>
                    <span class="text-white">–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –æ—Ç–º–µ–Ω–µ–Ω—ã –∞ –¥–æ–ª–≥–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.</span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="modal-action mt-6">
                <button id="confirmDeleteAccount" class="btn bg-red-600 hover:bg-red-700 text-white border-none rounded-lg px-6">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
                <label for="delete_account" class="btn btn-outline rounded-lg">–û—Ç–º–µ–Ω–∏—Ç—å</label>
            </div>
        </div>
    </div>


    <!-- type="change_percentage" -->
    <input type="checkbox" id="change_percentage" class="modal-toggle" />
    <div class="modal" role="dialog">
        <div class="modal-box w-11/12 max-w-md p-6">
            <h1 class="text-lg font-bold text-gray-800 mb-4">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞</h1>

            <div class="space-y-4">
                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
                <div class="p-3 border border-gray-200 rounded-xl bg-gray-50 flex flex-col">
                    <span class="font-semibold text-gray-700">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                    <span id="changePercentUserName" class="text-gray-800 mt-1 break-all">‚Äî</span>
                </div>

                <!-- –°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç -->
                <div class="p-3 border border-gray-200 rounded-xl bg-white flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div>
                        <span class="font-semibold text-gray-700">–°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç</span>
                        <div id="oldPercentage" class="text-gray-800 mt-1 text-lg font-medium">‚Äî%</div>
                    </div>
                    <!-- –∏–∫–æ–Ω–∫–∞-–ø–æ–¥—Å–∫–∞–∑–∫–∞ -->
                    <div class="text-sm text-gray-400 mt-2 sm:mt-0">–¢–µ–∫—É—â–∏–π</div>
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ -->
                <div class="flex flex-col">
                    <span class="font-semibold text-gray-700 mb-2">–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç:</span>
                    <label class="input w-full flex items-center gap-2 border rounded-md p-2 bg-white">
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M17 7a2 2 0 11-4 0 2 2 0 014 0zM7 17a2 2 0 104 0 2 2 0 00-4 0zM6 18L18 6" />
                        </svg>
                        <input type="text" id="new_percentage" name="percentage"
                               placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10)"
                               required class="w-full outline-none text-gray-800" />
                    </label>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="alert alert-info rounded-xl mt-3 text-white flex items-start gap-2 p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white mt-1" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
                    </svg>
                    <span class="text-white text-sm md:text-base">
                    –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–æ–ª–≥–∞–º.
                </span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="modal-action mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4 justify-end">
                <button id="confirmNewPercentage" class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
                <label for="change_percentage" class="btn btn-outline rounded-lg px-6 py-2 w-full sm:w-auto text-center">
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </label>
            </div>
        </div>
    </div>

    <dialog id="errorEmail" class="modal">
        <div class="modal-box w-11/12 max-w-md p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">–û—à–∏–±–∫–∞!</h3>
            <p id="errorText" class="py-4 text-gray-700">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ü–æ—á—Ç—ã</p>
            <div class="modal-action flex flex-col sm:flex-row justify-end gap-3">
                <form method="dialog" class="w-full sm:w-auto">
                    <button class="btn w-full sm:w-auto px-6 py-2 text-center">–ó–∞–∫—Ä—ã—Ç—å</button>
                </form>
            </div>
        </div>
    </dialog>


    <input type="checkbox" id="increase_debt" class="modal-toggle"/>
    <div class="modal" role="dialog">
        <div class="modal-box max-w-md">
            <h1 class="text-lg font-bold text-gray-800 mb-4">
                –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ–ª–≥
            </h1>

            <div class="space-y-3">
                <!-- –ò–º—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ -->
                <div class="p-3 border rounded-xl bg-gray-50">
                    <span class="font-semibold text-gray-700">–ü–æ—Å—Ç–∞–≤—â–∏–∫:</span>
                    <div id="debtUserName" class="text-gray-800 mt-1">‚Äî</div>
                </div>

                <!-- –¢–µ–∫—É—â–∏–π –¥–æ–ª–≥ -->
                <div class="p-3 border rounded-xl bg-gray-50">
                    <span class="font-semibold text-gray-700">–¢–µ–∫—É—â–∏–π –¥–æ–ª–≥:</span>
                    <div id="currentDebt" class="text-gray-800 mt-1">‚Äî ‚ÇΩ</div>
                </div>

                <!-- Input -->
                <div class="flex flex-col">
                <span class="font-semibold text-gray-700 mb-1">
                    –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ–ª–≥:
                </span>
                    <input
                            type="number"
                            id="increaseDebtValue"
                            class="input input-bordered w-full"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"
                            min="1"
                    />
                </div>

                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
                <div class="alert alert-info rounded-xl text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current text-white" fill="none"
                         viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z"/>
                    </svg>
                    <span>–ë—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –¥–æ–ª–≥ –∏ —Å–æ–∑–¥–∞–Ω–∞ —Ä—É—á–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ –æ–±—â–∏–π –¥–æ–ª–≥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —É–≤–µ–ª–∏—á–∏—Ç—Å—è.</span>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="modal-action mt-6">
                <button
                        class="btn bg-blue-600 hover:bg-blue-700 text-white border-none rounded-lg px-6"
                        onclick="saveIncreaseDebt()"
                >
                    –ò–∑–º–µ–Ω–∏—Ç—å
                </button>
                <label for="increase_debt" class="btn btn-outline rounded-lg">
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </label>
            </div>
        </div>
    </div>


    <script>
        const modalCheckbox = document.getElementById('change_email');
        const changeEmail = document.getElementById('change');
        const errorText = document.getElementById('errorText');
        const newEmailInput = document.getElementById('new_email');
        const passwordModalCheckbox = document.getElementById('change_password');
        const unlinkAccount = document.getElementById('unlink_account');
        const passwordInput = document.getElementById('new_password');
        const percentageInput = document.getElementById('new_percentage');
        const deleteAccount = document.getElementById('delete_account');
        const changePercentage = document.getElementById('change_percentage');
        const unlinkTransaction = document.getElementById('unlink_transaction');
        let currentUserId = null;
        let clientId = null;
        let leId = null;
        let user = null;
        let supplierClient = null;
        let unlinkTransactionId = null;

        const openErrorModal = (message) => {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorEmail').showModal();
        };

        const closeModalChange = (checkbox) => {
            checkbox.checked = false;
        };

        const isValidEmail = (email) => !!email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

        const isValidPassword = (password) => typeof password === 'string' && password.length >= 6;

        function openUnlinkTransactionModal({payer, receiver, commissionPercent, amount}) {
            document.getElementById('unlinkPayer').textContent = payer ?? '-';
            document.getElementById('unlinkReceiver').textContent = receiver ?? '-';
            document.getElementById('unlinkAmount').textContent = amount ?? '-';

            document.getElementById('unlink_transaction').checked = true;
        }

        document.querySelectorAll('label[for="change_email"]').forEach(button => {
            button.addEventListener('click', () => {
                currentUserId = button.dataset.entityUser_id;
                changeEmail.innerHTML = button.dataset.entity_email;
            });
        });

        document.getElementById('submitChangeEmail').addEventListener('click', async () => {
            const email = newEmailInput.value.trim();

            if (!isValidEmail(email)) {
                closeModalChange(modalCheckbox, newEmailInput);
                openErrorModal('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–æ—á—Ç—ã!');
                return;
            }

            const result = await postData('/user/changeEmail', {
                user_id: currentUserId,
                email: email
            });


            switch (result.value) {
                case 'repeat_email':
                    closeModalChange(modalCheckbox, newEmailInput);
                    openErrorModal('–¢–∞–∫–∞—è –ø–æ—á—Ç–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                    return;
                case 'Invalid parameters':
                    closeModalChange(modalCheckbox, newEmailInput);
                    openErrorModal('–ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!');
                    return;
            }


            if (result === 'error') {
                closeModalChange(modalCheckbox, newEmailInput);
                openErrorModal('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞!');
            }else {
                closeModalChange(modalCheckbox, newEmailInput);
                location.reload();
            }

        });

        document.getElementById('generatePassword')?.addEventListener('click', () => {
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let password = "";
            for (let i = 0; i < 12; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            passwordInput.value = password;
        });

        document.querySelectorAll('label[for="change_password"]').forEach(button => {
            button.addEventListener('click', () => {
                currentUserId = button.dataset.entityUser_id;
            });
        });

        document.querySelectorAll('label[for="delete_account"]').forEach(button => {
            button.addEventListener('click', () => {
                currentUserId = button.dataset.entityUser_id;

                const name = button.dataset.name;

                document.getElementById('deleteName').innerText = name;
            });
        });


        document.getElementById('submitChangePassword').addEventListener('click', async () => {
            const password = passwordInput.value.trim();

            if (!isValidPassword(password)) {
                closeModalChange(passwordModalCheckbox, passwordInput);
                openErrorModal('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }

            const result = await postData('/user/changePassword', {
                user_id: currentUserId,
                password: password
            });

            if (result === 'error') {
                closeModalChange(passwordModalCheckbox, passwordInput);
                openErrorModal('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞!');
            }

            if (result.success) {
                closeModalChange(passwordModalCheckbox, passwordInput);
                location.reload();
            } else {
                closeModalChange(passwordModalCheckbox, passwordInput);
                openErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å!');
            }
        });

        document.querySelectorAll('label[for="unlink_account"]').forEach(button => {
            button.addEventListener('click', () => {
                clientId = button.dataset.clientId;
                leId = button.dataset.leId;
                supplierClient = button.dataset.supplierClient ? parseInt(button.dataset.supplierClient) : null;

                const userName = button.dataset.userName;
                const companyName = button.dataset.companyName;
                const companyInn = button.dataset.companyInn;
                user = userName;

                document.getElementById('unlinkUserName').innerText = userName;
                document.getElementById('companyName').innerText = companyName;
                document.getElementById('companyInn').innerText = companyInn;
            });
        });

        document.querySelectorAll('button[data-transaction-id]').forEach(button => {
            button.addEventListener('click', () => {
                unlinkTransactionId = button.dataset.transactionId;
                openUnlinkTransactionModal({
                    payer: button.dataset.senderCompanyName,
                    receiver: button.dataset.recipientCompanyName,
                    amount: button.dataset.transactionAmount
                });
            });
        });


        document.querySelectorAll('label[for="change_percentage"]').forEach(button => {
            button.addEventListener('click', () => {
                currentUserId = button.dataset.entityUser_id;

                const userName = button.dataset.userName;
                const oldPercentage = button.dataset.oldPercentage;


                document.getElementById('changePercentUserName').innerText = userName;
                document.getElementById('oldPercentage').innerText = oldPercentage;

            });
        });

        document.getElementById('confirmUnlink').addEventListener('click', async () => {
            const result = await postData('/entities/unlinkAccount', {
                legal_id: leId
            });

            if (result.error === 'client_debt_suppliers') {
                openErrorModal(
                    '–ü–æ—Å—Ç–∞–≤—â–∏–∫ –ø—Ä–∏–≤—è–∑–∞–ª –∫–ª–∏–µ–Ω—Ç—É, –∏ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –¥–æ–ª–≥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É "' + user + '"'
                );
                return;
            }

            if (result.success) {
                closeModalChange(unlinkAccount);
                location.reload();
            } else {
                closeModalChange(unlinkAccount);
                openErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–≤—è–∑–∞—Ç—å —Å—á—ë—Ç!');
            }
        });

        document.getElementById('confirmUnlinkTransaction').addEventListener('click', async () => {
            const result = await postData('/supplier/unlinkTransaction', {
                transaction_id: unlinkTransactionId
            });

            if (result.success) {
                closeModalChange(unlinkTransaction);
                location.reload();
            } else {
                closeModalChange(unlinkTransaction);
                openErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–≤—è–∑–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é!');
            }
        });

        document.getElementById('changePassword–°lose')?.addEventListener('click', () => {
            closeModalChange(passwordModalCheckbox, passwordInput);
        });

        document.getElementById('changeEmailClose')?.addEventListener('click', () => {
            closeModalChange(changeEmail, newEmailInput);
        });

        document.getElementById('confirmDeleteAccount').addEventListener('click', async () => {
            const result = await postData('/user/userDelete', {
                user_id: currentUserId
            });


            if (result.success) {
                location.reload();
            } else {
                closeModalChange(deleteAccount, false);
                openErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
            }
        });

        document.getElementById('confirmNewPercentage').addEventListener('click', async () => {

            let percentage = percentageInput.value;

            const result = await postData('/user/changePercentage', {
                user_id: currentUserId,
                percentage: percentage
            });

            if (isNaN(percentage) || percentage < 0 || percentage > 100) {
                closeModalChange(changePercentage, percentageInput);
                openErrorModal('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç 0 –¥–æ 100.');
            }

            if (result.success) {
                location.reload();
            } else {
                closeModalChange(changePercentage, percentageInput);
                openErrorModal('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!');
            }

        });


        let increaseDebtData = {
            clientId: null,
            userName: null,
            currentDebt: null
        };

        function openIncreaseDebtModal(el) {
            increaseDebtData.clientId = el.dataset.clientId;
            increaseDebtData.userName = el.dataset.userName;
            increaseDebtData.currentDebt = el.dataset.currentDebit;

            document.getElementById('debtUserName').textContent = increaseDebtData.userName;
            document.getElementById('currentDebt').textContent =
                Number(increaseDebtData.currentDebt).toLocaleString('ru-RU') + ' ‚ÇΩ';

            document.getElementById('increaseDebtValue').value = '';

            document.getElementById('increase_debt').checked = true;
        }

        function saveIncreaseDebt() {
            const value = document.getElementById('increaseDebtValue').value;

            console.log('üìå –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ–ª–≥–∞');
            console.log('–ü–æ—Å—Ç–∞–≤—â–∏–∫:', increaseDebtData.userName);
            console.log('Client ID:', increaseDebtData.clientId);
            console.log('–¢–µ–∫—É—â–∏–π –¥–æ–ª–≥:', increaseDebtData.currentDebt);
            console.log('–î–æ–±–∞–≤–ª—è–µ–º–∞—è —Å—É–º–º–∞:', value);

            // –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º
            document.getElementById('increase_debt').checked = false;
        }
    </script>

{% endblock %}