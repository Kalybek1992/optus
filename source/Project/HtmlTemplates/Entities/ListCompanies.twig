{% extends './Navbar/Navbar.twig' %}

{% block content %}
    {% include './Breadcrumb/ListCompanies.twig' %}

    {% for company in companies %}
        <!-- Карточка клиента -->
        <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6 space-y-4 relative mt-4 text-xs sm:text-sm">
            <div class="space-y-3">
                <!-- Название компании -->
                <div class="text-lg sm:text-xl font-semibold text-gray-800 mb-2">{{ company.company_name }}</div>

                <div class="p-3 sm:p-4 bg-white rounded-xl shadow-sm uppercase border border-gray-200 space-y-2">
                    <!-- Банк -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">Банк :</div>
                        <div class="font-semibold text-black text-xs sm:text-sm">{{ company.bank_name }}</div>
                    </div>

                    <!-- Общий баланс -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">Всего поступило:</div>
                        <div class="font-semibold text-black text-xs sm:text-sm">{{ company.total_received|number_format(0, ',', ' ') }} ₽</div>
                    </div>

                    <!-- С вычетом 29% -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">С вычетом "всего поступило" 29%:</div>
                        <div class="font-semibold text-black text-xs sm:text-sm cursor-pointer">{{ company.total_received_interest|number_format(0, ',', ' ') }} ₽</div>
                    </div>

                    <!-- Всего списано -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">Всего списано :</div>
                        <div class="font-semibold text-black text-xs sm:text-sm">{{ company.total_written_off|number_format(0, ',', ' ') }} ₽</div>
                    </div>

                    <!-- Конечный остаток -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">Конечный остаток :</div>
                        <div class="font-semibold text-black text-xs sm:text-sm cursor-pointer">{{ company.final_remainder|number_format(0, ',', ' ') }} ₽</div>
                    </div>

                    <!-- Дата последней выписки -->
                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                        <div class="font-semibold text-gray-500 text-xs sm:text-sm">Дата последней выписке :</div>
                        <div class="font-semibold text-black text-xs sm:text-sm cursor-pointer">{{ company.date_created ?? '' }}</div>
                    </div>

                    <!-- Просрочено -->
                    {% if company.is_expired %}
                        <div class="flex flex-col border-b border-gray-200 pb-2 mb-2">
                            <div class="font-semibold text-gray-500 text-[10px] sm:text-xs">С момента последней загрузки документа прошло более 1 суток и 11 часов.</div>
                            <div class="flex items-center font-semibold text-black text-xs sm:text-sm cursor-pointer mt-1">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                     viewBox="0 0 24 24" stroke-width="1.5"
                                     stroke="currentColor"
                                     class="w-5 h-5 sm:w-6 sm:h-6 text-red-500">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374
                                             1.948 3.374h14.71c1.73 0 2.813-1.874
                                             1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898
                                             0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                                </svg>
                            </div>
                        </div>
                    {% endif %}
                </div>

                {# Карты компании #}
                {% if company.cards and company.cards|length > 0 %}
                    <details class="group mt-2">
                        <summary class="cursor-pointer flex items-center gap-2 font-semibold text-gray-800 mb-2 text-xs sm:text-sm">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5 transition-transform group-open:rotate-90"
                                 xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                 class="w-5 h-5 sm:w-6 sm:h-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
                            </svg>
                            <span>Карты компании</span>
                        </summary>

                        <div class="p-3 sm:p-4 border rounded-lg">
                            <div class="flex flex-col gap-2">
                                {% for card in company.cards %}
                                    <div class="flex flex-col border-b border-gray-200 pb-2 mb-2 p-1 sm:p-2 bg-white rounded shadow-sm text-xs sm:text-sm">
                                        <div class="font-semibold text-gray-500">Номер карты :</div>
                                        <div class="font-mono font-bold italic text-black">{{ card.card_number }}</div>
                                        <div class="font-semibold text-gray-500 mt-1">Баланс :</div>
                                        <div class="text-black">{{ card.balance }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </details>
                {% else %}
                    <a id="open-create-card-modal" data-company="{{ company.id }}"
                       class="flex flex-col gap-1 font-semibold text-gray-800 mb-2 px-2 py-1 rounded-md hover:bg-base-300 cursor-pointer text-xs sm:text-sm">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                 class="w-5 h-5 sm:w-6 sm:h-6 text-red-500">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374
                                         1.948 3.374h14.71c1.73 0 2.813-1.874
                                         1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898
                                         0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                            </svg>
                            <span>У компании карты отсутствуют</span>
                        </div>
                    </a>
                {% endif %}
            </div>
        </div>
    {% endfor %}

    <div class="flex items-center justify-center py-6">
        {% include './Pagination/Pagination.twig' %}
    </div>

    {% include './AddCardModal.twig' %}
{% endblock %}
