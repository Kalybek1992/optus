{% extends './Navbar/Navbar.twig' %}

{% block content %}
    {% include './Breadcrumb/ListCompanies.twig' %}

    {% for company in companies %}
        <!-- Карточка клиента -->
        <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6 space-y-4 relative mt-4">
            <!-- Верхняя часть: имя, почта, действия -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div class="text-xl font-semibold text-gray-800">{{ company.company_name }}</div>
                </div>

                <div class="p-4 bg-white rounded-xl shadow-sm text-sm uppercase border border-gray-200 space-y-2">
                    <!-- Банк -->
                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            Банк :
                        </div>
                        <div class="font-semibold text-gray-600 text-base">
                            {{ company.bank_name }}
                        </div>
                    </div>

                   <!-- Общий баланс или Долг -->
                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            Всего поступило :
                        </div>
                        <div class="font-semibold text-gray-600 text-base">
                            {{ company.total_received ?? 0 }}
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            С вычетом "всего поступило" 29%:
                        </div>
                        <div class="flex items-center font-semibold text-gray-600 text-base cursor-pointer">
                            {{ company.total_received_interest ?? 0 }}
                        </div>
                    </div>

                    <!-- Tоварный долг перед клиентом -->
                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            Всего списано :
                        </div>
                        <div class="font-semibold text-gray-600 text-base">
                            {{  company.total_written_off ?? 0 }}
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            Конечный остаток :
                        </div>
                        <div class="flex items-center font-semibold text-gray-600 text-base cursor-pointer">
                            {{ company.final_remainder ?? 0 }}
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="font-semibold text-gray-500">
                            Дата последней выписке :
                        </div>
                        <div class="flex items-center font-semibold text-gray-600 text-base cursor-pointer">
                            {{ company.date_created ?? '' }}
                        </div>
                    </div>

                    {% if company.is_expired %}
                        <div class="flex justify-between items-center">
                            <div class="font-semibold text-gray-500">
                                С момента последней загрузки документа прошло более 1 суток и 11 часов.
                            </div>
                            <div class="flex items-center font-semibold text-gray-600 text-base cursor-pointer">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                     viewBox="0 0 24 24" stroke-width="1.5"
                                     stroke="currentColor"
                                     class="size-6 text-red-500">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374
                                     1.948 3.374h14.71c1.73 0 2.813-1.874
                                     1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898
                                     0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                                </svg>
                            </div>
                        </div>
                    {% endif %}
                </div>

                {# Карты компании #}

                {% if company.cards and company.cards|length > 0 %}
                    <details class="group mt-2">
                        <summary class="cursor-pointer flex items-center gap-2 font-semibold text-gray-800 mb-2">
                            <svg class="size-5 transition-transform group-open:rotate-90"
                                 xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M9 5l7 7-7 7"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                 viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                 class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                      d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
                            </svg>
                            <span>Карты компании</span>
                        </summary>

                        <div class="p-4 border rounded-lg">
                            <div class="flex flex-col gap-3">
                                {% if company.cards and company.cards|length > 0 %}
                                    {% for card in company.cards %}
                                        <div class="flex justify-between items-center p-2 bg-white rounded shadow-sm border">
                                            <div>
                                                <span class="font-semibold text-gray-800">Номер:</span>
                                                <span class="font-mono font-bold italic text-gray-700">
                                                    {{ card.card_number }}
                                                </span>
                                            </div>
                                            <div>
                                                <span class="font-semibold text-gray-800">Баланс:</span>
                                                <span class="text-gray-700">{{ card.balance }}</span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div role="alert" class="alert alert-warning flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-200 rounded">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0 stroke-current text-yellow-500" fill="none" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                        </svg>
                                        <span>У компании отсутствуют карты!</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </details>
                {% else %}
                    <a id="open-create-card-modal" data-company="{{ company.id }}"
                       class="flex items-center gap-2 font-semibold text-gray-800 mb-2 px-2 py-1 rounded-md hover:bg-base-300 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                             viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor"
                             class="size-6 text-red-500">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374
                                     1.948 3.374h14.71c1.73 0 2.813-1.874
                                     1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898
                                     0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                        </svg>
                        У компании карты отсутствуют
                    </a>
                {% endif %}
            </div>
        </div>
    {% endfor %}


    <div class="flex items-center justify-center py-6">
        {% include './Pagination/Pagination.twig' %}
    </div>


    {% include './AddCardModal.twig' %}


{% endblock %}